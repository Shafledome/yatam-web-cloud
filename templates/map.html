{% extends 'base.html'%}
{% block content %}

<div class="hero is-fullheight is-primary">
  <div class="hero-head">
    <div class="block"></div>
    <div class="block">
      <div class="column is-three-fifths is-offset-one-fifth">
        <div class="box">
          <div class="tabs is-boxed is-fullwidth">
            <ul>
              <li>
                <a href="/home">
                  <span class="icon is-small"><i class="fas fa-landmark" aria-hidden="true"></i></span>
                    <span>YATAM - Leisures</span>
                </a>
              </li>
              <li>
                <a>
                  <span class="icon is-small"><i class="fas fa-monument" aria-hidden="true"></i></span>
                  <span>Leisures from Users</span>
                </a>
              </li>
              <li>
                <a>
                  <span class="icon is-small"><i class="fas fa-spray-can" aria-hidden="true"></i></span>
                  <span>Graffities</span>
                </a>
              </li>
              <li>
                <a href="/map">
                  <span class="icon is-small"><i class="fas fa-map-signs" aria-hidden="true"></i></span>
                  <span>Leisures Map</span>
                </a>
              </li>
              <li>
                <a>
                  <span class="icon is-small"><i class="fas fa-calendar" aria-hidden="true"></i></span>
                  <span>Events 2020</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="block"></div>
  <div class="columns">
    <div class="column is-2 is-offset-1">
      <div class="box">
        <aside class="menu">
          <p class="menu-label">
            Types of Leisures
          </p>
          <ul class="menu-list">
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="MUSEUM">
              Museums
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="ARTGALLERY">
              Art Galleries
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="DOGPARK">
              Dog Parks
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="MONUMENT">
              Monuments
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="TRAINING">
              Training Parks
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="LIBRARY">
              Libraries
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="CINEMA">
              Cinemas
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="THEATER">
              Theater
            </label></li>
            <li><label class="checkbox">
              <input type="checkbox" name="leisures" value="USERLEISURE">
              Users Leisures
            </label></li>
          </ul>
          <br>
          <a class="button is-primary" onclick="getLeisure()">Show Leisures</a>
        </aside>
      </div>
    </div>
    <div class="column is-8">
      <div class="box">
        <div id="map" style="height: 800px"></div>
      </div>
    </div>
  </div>
  <br><br>
</div>

<script>
  // Map declaration

  var map = L.map('map').setView([36.72, -4.42], 13);
  var markers = new Array();
  L.tileLayer(`https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png`, {

  }).addTo(map);

  // Icons creation
  function getType(leisure) {
    tipo = leisure.leisure_type;
    let iconType = L.icon({
      iconUrl: 'static/museum.svg',
      iconSize:[30,30],
      iconAnchor: [15,30]
    })
    switch(tipo){
      case "DOGPARK":
        iconType =  L.icon({
          iconUrl: 'static/dogPark.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "ARTGALLERY":
        iconType =  L.icon({
          iconUrl: 'static/artGallery.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "CINEMA":
        iconType =  L.icon({
          iconUrl: './static/cinema.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "LIBRARY":
        iconType =  L.icon({
          iconUrl: 'static/library.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "MONUMENT":
        iconType =  L.icon({
          iconUrl: 'static/monument.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "THEATER":
        iconType =  L.icon({
          iconUrl: 'static/theater.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "TRAINING":
        iconType =  L.icon({
          iconUrl: 'static/training.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        })
        break;
      case "USERLEISURE":
        iconType =  L.icon({
          iconUrl: 'static/Map-Pointer.svg',
          iconSize:[30,30],
          iconAnchor: [15,30]
        });
        break;
      default:
        break;
    }
    return iconType;

  }

  // Redirect to infoLeisure
  function infoLeisure(id){
   return "/leisure?id="+id;
  }

  // Update Map

  function deleteMarkers(){
    for(i = 0; i<markers.length;i++){
      map.removeLayer(markers[i]);
    }
  }

  function mostrarDatos(data) {
    data.map((leisure, i) =>{
      iconType = getType(leisure);
      var LamMarker = new L.marker(leisure.coordinates, {icon:iconType},{alt: infoLeisure(leisure.l_id)});
      markers.push(LamMarker);
      LamMarker.addTo(map);
      LamMarker.on('click',function (){
        window.location.href = infoLeisure(leisure.l_id);
      });

    })
  }

  function getLeisure(type){
        var leisure = document.getElementsByName("leisures");
        var result = [];
        var j = 0;
        for (i = 0; i<leisure.length; i++) {
            if (leisure[i].checked) {
                result[j] = leisure[i].value;
                j++;
            }
        }
        deleteMarkers();
        for (i = 0; i < result.length; i++) {
          fetchData(result[i]);
        }
  }

  function fetchData(result) {
    if (result.lenght == 0) {
            window.location.href('/map');
        } else {
            fetch(`${window.origin}/map`,{
                method: "POST",
                body: JSON.stringify(result),
                cache: "no-cache",
                headers: new Headers({
                    "content-type": "application/json"
                })
            }).then(function (response){
                if (response.status!== 200) {
                    console.log(`Response status was not 200 ${response.status}`);
                    return ;
                }
                response.json().then(function (data){
                  mostrarDatos(data);
                })
            })
        }
  }
</script>
{% endblock %}